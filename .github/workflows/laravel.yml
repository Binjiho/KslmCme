name: Deploy to Server

on:
  push:
    branches:
      - master  # master 브랜치에 푸시될 때마다 배포가 트리거됨

jobs:
  deploy:
    runs-on: ubuntu-latest  # Ubuntu 환경에서 실행

    steps:
      - name: Checkout code
        uses: actions/checkout@v2  # 레포지토리 코드를 체크아웃

      - name: Debug SSH connection
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USERNAME }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          port: 22006
          script: |
            echo "SSH 연결 성공!"  # SSH 연결 확인
            ssh -v -p 22006 kslm@${{ secrets.HOST }} "echo 'SSH 연결 성공!'"

      - name: Executing remote SSH commands using SSH key
        uses: appleboy/ssh-action@v1.2.0
        with:
            host: ${{ secrets.HOST }}
            username: ${{ secrets.USERNAME }}
            key: ${{ secrets.SSH_PRIVATE_KEY }}
            port: 22006
            script: |
              echo "Deploying..."
              cd /home/virtual/kslm/htdocs/kslm  # 올바른 경로로 수정
              git pull origin master
              sh deploy.sh
